# System Architecture

> **Note:** This document is the primary source of truth for the Foresight CDSS architecture.

## Overview

The Foresight CDSS is a modular, AI-powered clinical decision support system. It is designed with a clear separation of concerns to support both current functionality and future aspirations.

The application features several AI-powered clinical tools:
*   **Tool A (Advisor):** An AI-powered chatbot for general medical information.
*   **Tool B (Diagnosis and Treatment Engine):** A tool to produce diagnoses and treatment plans from patient data and consultation transcripts.
*   **Other Tools (Aspirational):** The architecture is designed to support future tools like a real-time AI co-pilot and a complex conditions alert system.

## User Roles & Application Flow

The application is designed for clinicians, with aspirational roles for administrators and support staff. The core workflows center around patient management, consultations, and interaction with the AI tools.

## Tech Stack

### Frontend
- **Core:** React, TypeScript, Next.js
- **UI:** Tailwind CSS, Shadcn/UI
- **State Management:** React Context, `useState`, `useReducer`

### Backend
- **Platform:** Supabase (PostgreSQL) for the database, authentication, and storage.
- **Custom Logic:** Next.js API Routes for custom endpoints (e.g., `/api/advisor`).
- **AI Tools:**
    - **Advisor:** Integrates with the OpenAI API.
    - **Diagnosis and Treatment Engine:** A Python-based prototype (`src/clinical_engine_prototype/engine.py`) is integrated and accessible via a Next.js API route.

## Frontend Architecture

### Core Principles
- Component-based design.
- Centralized routing logic.
- Global layout for a consistent UI structure.

### Directory Structure
- `src/app/`: Next.js App Router files.
- `src/components/`: Reusable React components.
- `src/lib/`: Utilities and services.

## Backend Architecture and Data Layer

### Data Source (Supabase)
The system uses a PostgreSQL database hosted on Supabase with a FHIR-aligned schema.

#### Key Tables
- `patients`: Patient demographic information.
- `encounters`: Patient encounters (visits, consultations).
- `conditions`: Diagnoses, problems, and health concerns.
- `lab_results`: Laboratory and observation data.
- `differential_diagnoses`: Differential diagnoses generated by the clinical engine.

### API Layer
- **Supabase APIs**: Auto-generated REST and GraphQL APIs.
- **Next.js API Routes**: Custom endpoints for features like the Advisor and the Clinical Engine.
- **Python Component**: The prototype for the Diagnosis and Treatment Engine is a Python script that is called by a Next.js API route.

## AI Tool Roadmap

The architecture is designed to support the following future capabilities:
- Enhancements to the Advisor, including better patient context awareness.
- Full implementation of the Diagnosis and Treatment Engine.
- Development of new tools like a real-time medical co-pilot and a complex conditions alert system. 